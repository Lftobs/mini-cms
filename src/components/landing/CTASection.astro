---
const { currentUser } = Astro.locals;
---

<div
  id="cta"
  class="w-full relative overflow-hidden flex flex-col justify-center items-center gap-2"
>
  <!-- Content -->
  <div
    class="self-stretch px-6 md:px-24 py-12 md:py-12 border-t border-b border-[rgba(55,50,47,0.12)] flex justify-center items-center gap-6 relative z-10"
  >
    <div class="absolute inset-0 w-full h-full overflow-hidden">
      <div class="w-full h-full relative">
        <template x-for="i in 300">
          <div
            class="absolute h-4 w-full rotate-[-45deg] origin-top-left outline outline-[0.5px] outline-[rgba(3,7,18,0.08)] outline-offset-[-0.25px]"
            :style="`top: ${i * 16 - 120}px; left: -100%; width: 300%;`"
          >
          </div>
        </template>
      </div>
    </div>

    <div
      class="w-full max-w-[586px] px-6 py-5 md:py-8 glass-card-trans overflow-hidden rounded-2xl flex flex-col justify-start items-center gap-6 relative z-20"
    >
      <div class="self-stretch flex flex-col justify-start items-start gap-3">
        <div
          class="self-stretch text-center flex justify-center flex-col text-[#49423D] text-3xl md:text-5xl font-semibold leading-tight md:leading-[56px] font-sans tracking-tight"
        >
          Ready to manage your content in GitHub?
        </div>
        <div
          class="self-stretch text-center text-[#605A57] text-base leading-7 font-sans font-medium"
        >
          Join developers and content teams using mini-cms
          <br />
          to edit MDX and Markdown files with full version control.
        </div>
      </div>
      <div
        class="w-full max-w-[497px] flex flex-col justify-center items-center gap-12"
      >
        <div
          class="flex justify-start items-center gap-4"
          x-data="ctaUser"
        >
          <a
            :href="user ? '/dashboard' : '/auth/login'"
            href={currentUser ? "/dashboard" : "/auth/login"}
            class="h-10 px-12 py-[6px] relative bg-gradient-to-r from-earth-200 to-earth-500 overflow-hidden rounded-full flex justify-center items-center cursor-pointer hover:scale-105 transition-transform duration-300"
          >
            <div
              class="flex flex-col justify-center text-white text-[13px] font-medium leading-5 font-sans"
            >
              <span x-text="user ? 'Go to Dashboard' : 'Start for free'">Start for free</span>
            </div>
          </a>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
    import { actions } from "astro:actions";
    import Alpine from "alpinejs";

    Alpine.data("ctaUser", () => ({
        user: null,
        async init() {
            if (!window.userPromise) {
                window.userPromise = actions.usersActions.me();
            }
            if (window.userPromise) {
                const { data } = await window.userPromise;
                if (data?.user) {
                    this.user = data.user;
                }
            }
        }
    }));
</script>
